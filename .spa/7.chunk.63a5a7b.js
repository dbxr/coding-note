/*! For license information please see 7.chunk.63a5a7b.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"./docs/.docbook/articles/redux-createStore.md":function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _redux_createStore_md_vue_type_template_id_2db2e4d4___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./redux-createStore.md?vue&type=template&id=2db2e4d4& */ "./docs/.docbook/articles/redux-createStore.md?vue&type=template&id=2db2e4d4&");\n/* harmony import */ var _redux_createStore_md_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./redux-createStore.md?vue&type=script&lang=js& */ "./docs/.docbook/articles/redux-createStore.md?vue&type=script&lang=js&");\n/* empty/unused harmony star reexport *//* harmony import */ var _node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js */ "./node_modules/vue-loader/lib/runtime/componentNormalizer.js");\n\n\n\n\n\n/* normalize component */\n\nvar component = Object(_node_modules_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_2__["default"])(\n  _redux_createStore_md_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__["default"],\n  _redux_createStore_md_vue_type_template_id_2db2e4d4___WEBPACK_IMPORTED_MODULE_0__["render"],\n  _redux_createStore_md_vue_type_template_id_2db2e4d4___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* harmony default export */ __webpack_exports__["default"] = (component.exports);\n\n//# sourceURL=webpack:///./docs/.docbook/articles/redux-createStore.md?')},"./docs/.docbook/articles/redux-createStore.md?vue&type=script&lang=js&":function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _node_modules_happypack_loader_js_id_babel_node_modules_vue_loader_lib_index_js_ref_2_0_node_modules_vue_md_loader_index_js_ref_2_1_redux_createStore_md_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../node_modules/happypack/loader.js?id=babel!../../../node_modules/vue-loader/lib??ref--2-0!../../../node_modules/vue-md-loader??ref--2-1!./redux-createStore.md?vue&type=script&lang=js& */ "./node_modules/happypack/loader.js?id=babel!./node_modules/vue-loader/lib/index.js?!./node_modules/vue-md-loader/index.js?!./docs/.docbook/articles/redux-createStore.md?vue&type=script&lang=js&");\n/* empty/unused harmony star reexport */ /* harmony default export */ __webpack_exports__["default"] = (_node_modules_happypack_loader_js_id_babel_node_modules_vue_loader_lib_index_js_ref_2_0_node_modules_vue_md_loader_index_js_ref_2_1_redux_createStore_md_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__["default"]); \n\n//# sourceURL=webpack:///./docs/.docbook/articles/redux-createStore.md?')},"./docs/.docbook/articles/redux-createStore.md?vue&type=template&id=2db2e4d4&":function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_vue_loader_lib_index_js_ref_2_0_node_modules_vue_md_loader_index_js_ref_2_1_redux_createStore_md_vue_type_template_id_2db2e4d4___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/vue-loader/lib??ref--2-0!../../../node_modules/vue-md-loader??ref--2-1!./redux-createStore.md?vue&type=template&id=2db2e4d4& */ "./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/vue-md-loader/index.js?!./docs/.docbook/articles/redux-createStore.md?vue&type=template&id=2db2e4d4&");\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_vue_loader_lib_index_js_ref_2_0_node_modules_vue_md_loader_index_js_ref_2_1_redux_createStore_md_vue_type_template_id_2db2e4d4___WEBPACK_IMPORTED_MODULE_0__["render"]; });\n\n/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _node_modules_vue_loader_lib_loaders_templateLoader_js_vue_loader_options_node_modules_vue_loader_lib_index_js_ref_2_0_node_modules_vue_md_loader_index_js_ref_2_1_redux_createStore_md_vue_type_template_id_2db2e4d4___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });\n\n\n\n//# sourceURL=webpack:///./docs/.docbook/articles/redux-createStore.md?')},"./node_modules/happypack/loader.js?id=babel!./node_modules/vue-loader/lib/index.js?!./node_modules/vue-md-loader/index.js?!./docs/.docbook/articles/redux-createStore.md?vue&type=script&lang=js&":function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n/* harmony default export */ __webpack_exports__["default"] = ({\n  components: {}\n});\n\n//# sourceURL=webpack:///./docs/.docbook/articles/redux-createStore.md?./node_modules/happypack/loader.js?id=babel!./node_modules/vue-loader/lib??ref--2-0!./node_modules/vue-md-loader??ref--2-1')},"./node_modules/vue-loader/lib/loaders/templateLoader.js?!./node_modules/vue-loader/lib/index.js?!./node_modules/vue-md-loader/index.js?!./docs/.docbook/articles/redux-createStore.md?vue&type=template&id=2db2e4d4&":function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });\nvar render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c(\'section\',[_c(\'p\',[_vm._v("本文将学习 createStore，并实现一个简单的 createStore。")]),_vm._v(" "),_c(\'h1\',{attrs:{"id":"createstore"}},[_vm._v("createStore "),_c(\'a\',{staticClass:"header-anchor",attrs:{"href":"#createstore"}})]),_vm._v(" "),_c(\'p\',[_vm._v("接下来就按照 "),_c(\'code\',{pre:true},[_vm._v("createStore")]),_vm._v(" 的内部流程来解读。")]),_vm._v(" "),_c(\'h2\',{attrs:{"id":"1-引入工具函数"}},[_vm._v("1 引入工具函数 "),_c(\'a\',{staticClass:"header-anchor",attrs:{"href":"#1-引入工具函数"}})]),_vm._v(" "),_c(\'p\',[_vm._v("createStore 引入的函数有：")]),_vm._v(" "),_c(\'ul\',[_c(\'li\',[_vm._v("symbol-observable (Symbol.observable 的 pollyfill)")]),_vm._v(" "),_c(\'li\',[_vm._v("ActionTypes")]),_vm._v(" "),_c(\'li\',[_vm._v("isPlainObject： 通过 Object.getPrototypeof 获取对象原型，比较以判断是否为 plain object")])]),_vm._v(" "),_c(\'h2\',{attrs:{"id":"2-参数声明"}},[_vm._v("2 参数声明 "),_c(\'a\',{staticClass:"header-anchor",attrs:{"href":"#2-参数声明"}})]),_vm._v(" "),_c(\'p\',[_vm._v("createStore 接受三个参数：")]),_vm._v(" "),_c(\'ul\',[_c(\'li\',[_vm._v("reducer：根据当前的 state tree 和 要触发的 action 来生成并返回 新的（next）state tree")]),_vm._v(" "),_c(\'li\',[_vm._v("preloadedState: 可选的初始 state")]),_vm._v(" "),_c(\'li\',[_vm._v("enhancer: 可选的用以增强 store 的 第三方能力")])]),_vm._v(" "),_c(\'p\',[_vm._v("createStore 返回一个 redux store 用以读取 state、触发 action 和 订阅 changes")]),_vm._v(" "),_c(\'h2\',{attrs:{"id":"3-内部流程"}},[_vm._v("3 内部流程 "),_c(\'a\',{staticClass:"header-anchor",attrs:{"href":"#3-内部流程"}})]),_vm._v(" "),_c(\'p\',[_vm._v("首先，判断 preloadedState 和 enhancer:")]),_vm._v(" "),_c(\'pre\',{pre:true},[_c(\'code\',{pre:true,attrs:{"v-pre":"","class":"language-javascript"}},[_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("if")]),_vm._v(" ("),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("typeof")]),_vm._v(" preloadedState === "),_c(\'span\',{pre:true,attrs:{"class":"hljs-string"}},[_vm._v("\\"function\\"")]),_vm._v(" && "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("typeof")]),_vm._v(" enhancer === "),_c(\'span\',{pre:true,attrs:{"class":"hljs-string"}},[_vm._v("\\"undefined\\"")]),_vm._v(") {\\n  enhancer = preloadedState;\\n  preloadedState = "),_c(\'span\',{pre:true,attrs:{"class":"hljs-literal"}},[_vm._v("undefined")]),_vm._v(";\\n}\\n\\n"),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("if")]),_vm._v(" ("),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("typeof")]),_vm._v(" enhancer !== "),_c(\'span\',{pre:true,attrs:{"class":"hljs-string"}},[_vm._v("\\"undefined\\"")]),_vm._v(") {\\n  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("if")]),_vm._v(" ("),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("typeof")]),_vm._v(" enhancer !== "),_c(\'span\',{pre:true,attrs:{"class":"hljs-string"}},[_vm._v("\\"function\\"")]),_vm._v(") {\\n    "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("throw")]),_vm._v(" "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("new")]),_vm._v(" "),_c(\'span\',{pre:true,attrs:{"class":"hljs-built_in"}},[_vm._v("Error")]),_vm._v("("),_c(\'span\',{pre:true,attrs:{"class":"hljs-string"}},[_vm._v("\\"Expected the enhancer to be a function.\\"")]),_vm._v(");\\n  }\\n\\n  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("return")]),_vm._v(" enhancer(createStore)(reducer, preloadedState);\\n}\\n")])]),_vm._v(" "),_c(\'p\',[_vm._v("所以 "),_c(\'code\',{pre:true},[_vm._v("enhancer")]),_vm._v(" 应是一个 柯里化函数，如果给定了 "),_c(\'code\',{pre:true},[_vm._v("enhancer")]),_vm._v(" 则 直接调用 "),_c(\'code\',{pre:true},[_vm._v("reducer")]),_vm._v(" 和 "),_c(\'code\',{pre:true},[_vm._v("preloadedState")]),_vm._v(" 返回 "),_c(\'code\',{pre:true},[_vm._v("enhanced")]),_vm._v(" 的 "),_c(\'code\',{pre:true},[_vm._v("store")]),_vm._v("（当然也是 createstore 生成 ）。\\n其次，判断 reducer 是否为函数，不是则报错：")]),_vm._v(" "),_c(\'pre\',{pre:true},[_c(\'code\',{pre:true,attrs:{"v-pre":"","class":"language-javascript"}},[_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("if")]),_vm._v(" ("),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("typeof")]),_vm._v(" reducer !== "),_c(\'span\',{pre:true,attrs:{"class":"hljs-string"}},[_vm._v("\\"function\\"")]),_vm._v(") {\\n  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("throw")]),_vm._v(" "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("new")]),_vm._v(" "),_c(\'span\',{pre:true,attrs:{"class":"hljs-built_in"}},[_vm._v("Error")]),_vm._v("("),_c(\'span\',{pre:true,attrs:{"class":"hljs-string"}},[_vm._v("\\"Expected the reducer to be a function.\\"")]),_vm._v(");\\n}\\n")])]),_vm._v(" "),_c(\'p\',[_vm._v("紧接着，声明了以下变量：")]),_vm._v(" "),_c(\'pre\',{pre:true},[_c(\'code\',{pre:true,attrs:{"v-pre":"","class":"language-javascript"}},[_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("let")]),_vm._v(" currentReducer = reducer;\\n"),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("let")]),_vm._v(" currentState = preloadedState;\\n"),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("let")]),_vm._v(" currentListeners = [];\\n"),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("let")]),_vm._v(" nextListeners = currentListeners;\\n"),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("let")]),_vm._v(" isDispatching = "),_c(\'span\',{pre:true,attrs:{"class":"hljs-literal"}},[_vm._v("false")]),_vm._v(";\\n")])]),_vm._v(" "),_c(\'p\',[_vm._v("然后 dispatch 初始化 action（dispatch({ type: ActionTypes.INIT })） （这样每个 reducer 都会返回自己的初始状态，这样就有效地填充了 初始的 state tree）\\n最后返回一个对象：")]),_vm._v(" "),_c(\'pre\',{pre:true},[_c(\'code\',{pre:true,attrs:{"v-pre":"","class":"language-javascript"}},[_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("return")]),_vm._v(" {\\n  dispatch,\\n  subscribe,\\n  getState,\\n};\\n")])]),_vm._v(" "),_c(\'h2\',{attrs:{"id":"4-dispatch-action"}},[_vm._v("4 dispatch (action) "),_c(\'a\',{staticClass:"header-anchor",attrs:{"href":"#4-dispatch-action"}})]),_vm._v(" "),_c(\'p\',[_vm._v("dispatch 是唯一的触发 状态变化（state change）的途径，它只接受一个 isPlainObject 的 action，具体流程如下：")]),_vm._v(" "),_c(\'ol\',[_c(\'li\',[_vm._v("判断 "),_c(\'code\',{pre:true},[_vm._v("action")]),_vm._v(" 是否 "),_c(\'code\',{pre:true},[_vm._v("isPlainObject")]),_vm._v("，否则报错")]),_vm._v(" "),_c(\'li\',[_vm._v("判断是否声明了 "),_c(\'code\',{pre:true},[_vm._v("action.type")]),_vm._v(" ，没有则报错")]),_vm._v(" "),_c(\'li\',[_vm._v("判断是否 "),_c(\'code\',{pre:true},[_vm._v("isDispatching")]),_vm._v("，如果是报错（目前无法 "),_c(\'code\',{pre:true},[_vm._v("dispatch action")]),_vm._v("）")]),_vm._v(" "),_c(\'li\',[_vm._v("尝试调用 "),_c(\'code\',{pre:true},[_vm._v("currentReducer")]),_vm._v(" (传入的 "),_c(\'code\',{pre:true},[_vm._v("reducer")]),_vm._v(")")])]),_vm._v(" "),_c(\'pre\',{pre:true},[_c(\'code\',{pre:true,attrs:{"v-pre":"","class":"language-javascript"}},[_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("try")]),_vm._v(" {\\n  isDispatching = "),_c(\'span\',{pre:true,attrs:{"class":"hljs-literal"}},[_vm._v("true")]),_vm._v(";\\n  currentState = currentReducer(currentState, action);\\n} "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("finally")]),_vm._v(" {\\n  isDispatching = "),_c(\'span\',{pre:true,attrs:{"class":"hljs-literal"}},[_vm._v("false")]),_vm._v(";\\n}\\n\\n"),_c(\'span\',{pre:true,attrs:{"class":"hljs-comment"}},[_vm._v("// 依次调用 listeners")]),_vm._v("\\n"),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("const")]),_vm._v(" listeners = (currentListeners = nextListeners);\\n"),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("for")]),_vm._v(" ("),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("let")]),_vm._v(" i = "),_c(\'span\',{pre:true,attrs:{"class":"hljs-number"}},[_vm._v("0")]),_vm._v("; i < listeners.length; i++) {\\n  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("const")]),_vm._v(" listener = listeners[i];\\n  listener();\\n}\\n")])]),_vm._v(" "),_c(\'h2\',{attrs:{"id":"5-subscribe"}},[_vm._v("5 subscribe "),_c(\'a\',{staticClass:"header-anchor",attrs:{"href":"#5-subscribe"}})]),_vm._v(" "),_c(\'p\',[_vm._v("subscribe 接收一个 "),_c(\'code\',{pre:true},[_vm._v("listener")]),_vm._v(" 函数，它首先 "),_c(\'code\',{pre:true},[_vm._v("ensureCanMutateNextListeners")]),_vm._v("（通过 "),_c(\'code\',{pre:true},[_vm._v("nextListeners = currentListeners.slice()")]),_vm._v(" 保存当前的监听函数 ），当初次"),_c(\'code\',{pre:true},[_vm._v(" ensures")]),_vm._v(" 时，"),_c(\'code\',{pre:true},[_vm._v("nextListeners")]),_vm._v("为 []，然后将传入的 "),_c(\'code\',{pre:true},[_vm._v("listener")]),_vm._v(" 加入到 "),_c(\'code\',{pre:true},[_vm._v("nextListeners")]),_vm._v("，这样 "),_c(\'code\',{pre:true},[_vm._v("nextListeners")]),_vm._v("中便有了 "),_c(\'code\',{pre:true},[_vm._v("listeners")]),_vm._v("，这样在"),_c(\'code\',{pre:true},[_vm._v("dispacth")]),_vm._v(" 中便有了 listeners 便可以循环调用 "),_c(\'code\',{pre:true},[_vm._v("listeners")]),_vm._v("，同时 subscribe 返回一个包含取消监听函数的对象。")]),_vm._v(" "),_c(\'h2\',{attrs:{"id":"6-模仿实现"}},[_vm._v("6 模仿实现 "),_c(\'a\',{staticClass:"header-anchor",attrs:{"href":"#6-模仿实现"}})]),_vm._v(" "),_c(\'p\',[_vm._v("目前可以简单总结下 "),_c(\'code\',{pre:true},[_vm._v("createStore")]),_vm._v(" 返回一个主要包含（我说的主要） "),_c(\'code\',{pre:true},[_vm._v("getState")]),_vm._v("、"),_c(\'code\',{pre:true},[_vm._v("subscribe")]),_vm._v(" 和 "),_c(\'code\',{pre:true},[_vm._v("dispatch")]),_vm._v("。通过"),_c(\'code\',{pre:true},[_vm._v("dispatch ation")]),_vm._v(" 调用 "),_c(\'code\',{pre:true},[_vm._v("reducer(currentState, action)")]),_vm._v("以完成 "),_c(\'code\',{pre:true},[_vm._v("change state")]),_vm._v("，那么接下来按照这个思路实现一个简单的 "),_c(\'code\',{pre:true},[_vm._v("createStore")]),_vm._v(":")]),_vm._v(" "),_c(\'pre\',{pre:true},[_c(\'code\',{pre:true,attrs:{"v-pre":"","class":"language-javascript"}},[_c(\'span\',{pre:true,attrs:{"class":"hljs-function"}},[_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("function")]),_vm._v(" "),_c(\'span\',{pre:true,attrs:{"class":"hljs-title"}},[_vm._v("createStore")]),_vm._v("("),_c(\'span\',{pre:true,attrs:{"class":"hljs-params"}},[_vm._v("reducer, preloadedState")]),_vm._v(") ")]),_vm._v("{\\n  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("let")]),_vm._v(" currentState = preloadedState;\\n  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("let")]),_vm._v(" listeners = [];\\n\\n  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-function"}},[_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("function")]),_vm._v(" "),_c(\'span\',{pre:true,attrs:{"class":"hljs-title"}},[_vm._v("getState")]),_vm._v("("),_c(\'span\',{pre:true,attrs:{"class":"hljs-params"}}),_vm._v(") ")]),_vm._v("{\\n    "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("return")]),_vm._v(" currentState;\\n  }\\n\\n  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-function"}},[_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("function")]),_vm._v(" "),_c(\'span\',{pre:true,attrs:{"class":"hljs-title"}},[_vm._v("subscribe")]),_vm._v("("),_c(\'span\',{pre:true,attrs:{"class":"hljs-params"}},[_vm._v("listener")]),_vm._v(") ")]),_vm._v("{\\n    listeners.push(listener);\\n\\n    "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("return")]),_vm._v(" {\\n      "),_c(\'span\',{pre:true,attrs:{"class":"hljs-function"}},[_c(\'span\',{pre:true,attrs:{"class":"hljs-title"}},[_vm._v("unsubscribe")]),_vm._v("("),_c(\'span\',{pre:true,attrs:{"class":"hljs-params"}}),_vm._v(")")]),_vm._v(" {\\n        "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("let")]),_vm._v(" index = listeners.indexOf(listener);\\n        listeners.splice(index, "),_c(\'span\',{pre:true,attrs:{"class":"hljs-number"}},[_vm._v("1")]),_vm._v(");\\n      },\\n    };\\n  }\\n\\n  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-function"}},[_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("function")]),_vm._v(" "),_c(\'span\',{pre:true,attrs:{"class":"hljs-title"}},[_vm._v("dispatch")]),_vm._v("("),_c(\'span\',{pre:true,attrs:{"class":"hljs-params"}},[_vm._v("action")]),_vm._v(") ")]),_vm._v("{\\n    "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("try")]),_vm._v(" {\\n      currentState = reducer(currentState, action);\\n    } "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("finally")]),_vm._v(" {\\n    }\\n\\n    "),_c(\'span\',{pre:true,attrs:{"class":"hljs-comment"}},[_vm._v("// 遍历监听函数")]),_vm._v("\\n    "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("for")]),_vm._v(" ("),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("let")]),_vm._v(" i = "),_c(\'span\',{pre:true,attrs:{"class":"hljs-number"}},[_vm._v("0")]),_vm._v("; i < listeners.length; i++) {\\n      listeners[i]();\\n    }\\n\\n    "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("return")]),_vm._v(" action;\\n  }\\n\\n  dispatch({ "),_c(\'span\',{pre:true,attrs:{"class":"hljs-attr"}},[_vm._v("type")]),_vm._v(": "),_c(\'span\',{pre:true,attrs:{"class":"hljs-string"}},[_vm._v("\\"INIT\\"")]),_vm._v(" });\\n\\n  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("return")]),_vm._v(" {\\n    getState,\\n    dispatch,\\n    subscribe,\\n  };\\n}\\n")])]),_vm._v(" "),_c(\'p\',[_vm._v("测试以下:")]),_vm._v(" "),_c(\'pre\',{pre:true},[_c(\'code\',{pre:true,attrs:{"v-pre":"","class":"language-javascript"}},[_c(\'span\',{pre:true,attrs:{"class":"hljs-function"}},[_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("function")]),_vm._v(" "),_c(\'span\',{pre:true,attrs:{"class":"hljs-title"}},[_vm._v("reducer")]),_vm._v("("),_c(\'span\',{pre:true,attrs:{"class":"hljs-params"}},[_vm._v("state, action")]),_vm._v(") ")]),_vm._v("{\\n  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("switch")]),_vm._v(" (action.type) {\\n    "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("case")]),_vm._v(" "),_c(\'span\',{pre:true,attrs:{"class":"hljs-string"}},[_vm._v("\\"ADD\\"")]),_vm._v(":\\n      "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("let")]),_vm._v(" count = state.count;\\n      count++;\\n      "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("return")]),_vm._v(" { ...state, count };\\n\\n    "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("default")]),_vm._v(":\\n      "),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("return")]),_vm._v(" state;\\n  }\\n}\\n\\n"),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("const")]),_vm._v(" store = createStore(reducer, { "),_c(\'span\',{pre:true,attrs:{"class":"hljs-attr"}},[_vm._v("count")]),_vm._v(": "),_c(\'span\',{pre:true,attrs:{"class":"hljs-number"}},[_vm._v("0")]),_vm._v(" });\\n\\n"),_c(\'span\',{pre:true,attrs:{"class":"hljs-keyword"}},[_vm._v("let")]),_vm._v(" listener = store.subscribe("),_c(\'span\',{pre:true,attrs:{"class":"hljs-function"}},[_vm._v("() =>")]),_vm._v("\\n  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-built_in"}},[_vm._v("console")]),_vm._v(".log("),_c(\'span\',{pre:true,attrs:{"class":"hljs-string"}},[_vm._v("\\"订阅store.count: \\"")]),_vm._v(", store.getState().count)\\n);\\n\\nstore.dispatch({ "),_c(\'span\',{pre:true,attrs:{"class":"hljs-attr"}},[_vm._v("type")]),_vm._v(": "),_c(\'span\',{pre:true,attrs:{"class":"hljs-string"}},[_vm._v("\\"ADD\\"")]),_vm._v(" });\\nstore.dispatch({ "),_c(\'span\',{pre:true,attrs:{"class":"hljs-attr"}},[_vm._v("type")]),_vm._v(": "),_c(\'span\',{pre:true,attrs:{"class":"hljs-string"}},[_vm._v("\\"ADD\\"")]),_vm._v(" });\\n\\nlistener.unsubscribe();\\n\\nstore.dispatch({ "),_c(\'span\',{pre:true,attrs:{"class":"hljs-attr"}},[_vm._v("type")]),_vm._v(": "),_c(\'span\',{pre:true,attrs:{"class":"hljs-string"}},[_vm._v("\\"ADD\\"")]),_vm._v(" });\\n")])]),_vm._v(" "),_c(\'p\',[_vm._v("输出如下：")]),_vm._v(" "),_c(\'pre\',{pre:true},[_c(\'code\',{pre:true,attrs:{"v-pre":"","class":"language-javascript"}},[_vm._v("订阅store.count:  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-number"}},[_vm._v("1")]),_vm._v("\\n订阅store.count:  "),_c(\'span\',{pre:true,attrs:{"class":"hljs-number"}},[_vm._v("2")]),_vm._v("\\n")])]),_vm._v(" "),_c(\'h1\',{attrs:{"id":"总结"}},[_vm._v("总结 "),_c(\'a\',{staticClass:"header-anchor",attrs:{"href":"#总结"}})]),_vm._v(" "),_c(\'p\',[_vm._v("通过阅读 "),_c(\'code\',{pre:true},[_vm._v("createStore")]),_vm._v(" 的源码可以发现这部分的核心主要就是在 "),_c(\'code\',{pre:true},[_vm._v("reducer")]),_vm._v("、"),_c(\'code\',{pre:true},[_vm._v("dispatch")]),_vm._v(" 以及 "),_c(\'code\',{pre:true},[_vm._v("state")]),_vm._v("，理清楚这些便明白了 "),_c(\'code\',{pre:true},[_vm._v("createStore")]),_vm._v(" 的简单与巧妙。")])])}]\n\n\n\n//# sourceURL=webpack:///./docs/.docbook/articles/redux-createStore.md?./node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/vue-loader/lib??ref--2-0!./node_modules/vue-md-loader??ref--2-1')}}]);